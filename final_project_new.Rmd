---
title: "college_basketball"
author: "Will Curkan"
date: "11/14/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(corrplot)
library(RColorBrewer)
library(stringr)
library(readxl)
```

```{r import data}
bb_dat = read.csv("CollegeBasketballPlayers2009-2021.csv")
school_dat = read_excel("bb_school_ranks.xlsx")

```

Cleaned data to make easier to work with:
1. rename variables to readable, workable names
2. filter to recent 3 years
3. remove less-meaningful variables
```{r data cleanup}
new_bb = bb_dat %>%
  rename(role = X, player = player_name) %>%
  filter(year > 2018) %>%
  select(!ht & !dunksmade & !dunksmiss.dunksmade
         & !dunksmade..dunksmade.dunksmiss.
         & !type & !num & !pid & !pick & !pfr
         & !Rec.Rank)


#rename school to team to match new_bb
new_ranks = school_dat %>%
  rename(team = school) %>%
  add_count(team)%>%
  rename(appearances = n)

```

Creating joined frame to work with top 25 ranked schools:
```{r joined}
top_25s = right_join(new_bb,new_ranks) %>%
  relocate(college_year = yr, year, role, .before = GP)


top_25s %>%
  filter(!college_year == "Sr") %>%
  add_count(player) %>%
  filter(n == 3) %>%
  unique()
```
1. How many teams in the NCAA

```{r NCAA intro facts}
#unique teams in NCAA n = 358, all divisions
new_bb %>%
  distinct(team) %>%
  count()

#unique players in NCAA, 8697 in 2018+
new_bb %>%
  distinct(player) %>%
  count()
```

```{r free throws}
new_bb %>%
  filter(FTA > 58 & FT_per > .769) %>%
  ggplot(aes(x = FTA,y = FT_per)) +
  geom_point() + 
  geom_smooth()+
  xlab("Free Throw Attempts") +
  ylab("Free Throw Percentage")+
  ggtitle("General Free Throw Comparison")

#guards
new_bb %>%
  filter(FTA > 58 & FT_per > .769) %>%
      filter(role == "Combo G" | role == "Scoring PG"
        | role == "Wing G" | role == "Pure PG") %>%
  ggplot(aes(x = FTA,y = FT_per)) +
  geom_point() + 
  geom_smooth()+
  xlab("Free Throw Attempts") +
  ylab("Free Throw Percentage")+
  ggtitle("Guard Free Throws")

#Centers/Powerforwards
new_bb %>%
  filter(FTA > 58 & FT_per > .769) %>%
  filter(role == "PF/C" | role == "C"
        | role == "Wing F" | role == "Stretch 4") %>%
  ggplot(aes(x = FTA,y = FT_per)) +
  geom_point() + 
  geom_smooth()+
  xlab("Free Throw Attempts") +
  ylab("Free Throw Percentage")+
  ggtitle("Post Player Free Throws")

quantile(new_bb$FT_per,c(.25,.5,.75))
quantile(new_bb$FTA,c(.25,.5,.75))
```

```{r rebound comparison}
new_bb %>%
  filter(GP > 29) %>%
  ggplot(aes(x = ORB_per,y = DRB_per)) +
  geom_point() + 
  geom_smooth()+ 
  xlab("Offensive Rebound Percentage")+
  ylab("Defensive Rebound Percentage")+
  ggtitle("Rebound Comparison")

#Guards
new_bb %>%
  filter(GP > 29) %>%
    filter(role == "Combo G" | role == "Scoring PG"
        | role == "Wing G" | role == "Pure PG") %>%
  ggplot(aes(x = ORB_per,y = DRB_per)) +
  geom_point() + 
  geom_smooth()+ 
  xlab("Offensive Rebound Percentage")+
  ylab("Defensive Rebound Percentage")+
  ggtitle("Guard Rebound Comparison")

#Center/Powerforwards
new_bb %>%
  filter(GP > 29) %>%
  filter(role == "PF/C" | role == "C"
        | role == "Wing F" | role == "Stretch 4") %>%
  ggplot(aes(x = ORB_per,y = DRB_per)) +
  geom_point() + 
  geom_smooth()+ 
  xlab("Offensive Rebound Percentage")+
  ylab("Defensive Rebound Percentage")+
  ggtitle("Post Player Rebound Comparison")

quantile(new_bb$GP,c(.25,.5,.75))
```

```{r top 10 asts}
options(scipen = 999)
top_25s %>%
  na.omit() %>%
  filter(appearances == 3) %>%
  group_by(team) %>%
  summarize(n = sum(ast))%>%
  arrange(desc(n)) %>%
  slice(1:10) %>%
  ggplot()+
  geom_col(aes(x = team,y = n,fill = team))+
  ggtitle("Total Assist for Team with 3 appearances")+
  xlab("Team")+
  ylab("Assists")+
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank())
  
top_25s %>%
  na.omit() %>%
  filter(appearances == 2)%>%
  group_by(team) %>%
  summarize(n = sum(ast)) %>%
  arrange(desc(n)) %>%
   slice(1:10) %>%
  ggplot()+
  geom_col(aes(x = team,y = n,fill = team))+
  ggtitle("Total Assist for Team with 2 appearances")+
  xlab("Team")+
  ylab("Assists")+
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank())
  
top_25s %>%
  na.omit() %>%
  filter(appearances == 1) %>%
  group_by(team) %>%
  summarize(n = sum(ast))%>%
  arrange(desc(n)) %>%
   slice(1:10) %>%
  ggplot()+
  geom_col(aes(x = team,y = n,fill = team))+
  ggtitle("Total Assist for Team With 1 Appearance")+
  xlab("Team")+
  ylab("Assists")+
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank())

#full graph with all 25 teams
top_25s %>%
  na.omit() %>%
  group_by(team) %>%
  summarize(n = sum(ast))%>%
  arrange(desc(n)) %>%
  ggplot()+
  geom_col(aes(x = team,y = n,fill = team))+
  ggtitle("Total Assist for all teams")+
  xlab("Team")+
  ylab("Assists")+
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank())
  
```

```{r ast/tov}
top_25s %>%
  na.omit() %>%
  filter(ast.tov > 1 & GP > 30) %>%
  ggplot(aes(x = GP,y = ast.tov))+
  geom_point()+
  geom_smooth()
  
```

In order to create a dream team for the 2022 season we must look at freshman in 2018-2019, freshman and sophmores in 2019-2020, and freshman, sophmore, and juniors in 2020-2021
```{r freshman 2019 filters}
#top freshman guards
top_fr_guards = top_25s %>%
  filter(college_year == 'Fr' & year == 2019 & GP > 25) %>%
  filter(role == "Combo G" | role == "Scoring PG"
        | role == "Wing G" | role == "Pure PG")


#top powerforwards and centers
top_fr_PfC = top_25s %>%
  filter(college_year == 'Fr' & year == 2019) %>%
  filter(role == "PF/C" | role == "C"
        | role == "Wing F" | role == "Stretch 4")

# corrplot(cor(cont_dat),type="upper", order="hclust",col=brewer.pal(n=8, name="RdYlBu"))
``` 

```{r freshman plots}
top_fr_guards %>% 
  select(where(is.double))
  
top_fr_guards %>%
  ggplot(aes(x = twoPA)) +
  geom_histogram()

top_fr_PfC %>%
  ggplot(aes(x = twoPA,y = twoPM)) +
  geom_violin()

top_fr_PfC %>%
  arrange(desc(DRB_per,twoP_per)) %>%
  slice(1:5) %>%
  ggplot(aes(x = DRB_per,y = twoP_per)) +
  geom_point() +
  geom_smooth() + 
  geom_text(aes(label=player))

top_fr_PfC %>%
  arrange(desc(DRB_per,twoP_per)) %>%
  slice(1:5) %>%
  ggplot(aes(x = DRB_per,y = twoP_per)) +
  geom_point() +
  geom_smooth() + 
  geom_text(aes(label=player))


#filter for top DRB percentage and shooting
top_fr_PfC %>%
  arrange(desc(DRB_per,twoP_per)) %>%
  filter(Min_per > 50)
  

```

```{r fresh_soph_2020 filters}
#filters for freshman and sophmores in 2018-2019 season
top_25_2soph_2020 = top_25s %>%
  filter(college_year == "Fr" & year == 2020
         |college_year == "So" & year == 2020)

#top guards
top_2soph_role_g_2020 = top_25_2soph_2020 %>%
    filter(role == "Combo G" | role == "Scoring PG"
         | role == "Wing G" | role == "Pure PG")

#top powerforwards/center
top_2soph_role_pfC_2020 = top_25_2soph_2020 %>%
      filter(role == "PF/C" | role == "C"
         | role == "Wing F" | role == "Stretch 4")
```


```{r to juniors 2021}
#freshman, sophmore, juniors in 2020-2021 season

#top guards
top_2jnr_guards = top_25s %>%
  filter(!yr == "Sr") %>%
  filter(role == "Combo G" | role == "Scoring PG"
         | role == "Wing G" | role == "Pure PG")

#top powerforwards/center
top_2jnr_PfC = top_25s %>%
  filter(!yr == "Sr") %>%
  filter(role == "PF/C" | role == "C"
         | role == "Wing F" | role == "Stretch 4")


```




1. Correlation between year (freshman, sophmore, etc) and stats
or recurring players and juniors
```{r}
#looking at individual recurring players stats
recurring_andJuniors = top_25s %>%
  add_count(player) %>%
  filter(college_year == "Jr" | n == 3 & GP > 20)

#use scatterplot to compare individual recurring stats maybe
recurring_players %>%
  filter(GP > 20) %>%
  ggplot(aes(x=player,y=pts)) + 
  geom_point(aes(x=player,y=pts,color=player)) + 
  theme_linedraw() +
  xlab("Role") + 
  ylab("Points") +
  scale_x_discrete(labels = paste0('p',c(1:9)))


```






```{r}
new_bb$role[new_bb$role == ""] <- NA
new_bb %>% na.omit() %>% ggplot(aes(x=role,y=pts,fill=role)) +
  geom_boxplot(aes(na.rm=T)) + theme_linedraw() + 
  xlab("Role") + ylab("Points")

new_bb  %>% na.omit() %>% ggplot(aes(x=role,y=pts,fill=role)) + 
  geom_boxplot(aes(x=role,y=pts,fill=role,na.rm=T)) + 
  geom_text_repel(data = subset(bb_dat, pts >= 26), aes(label = player_name))+theme_linedraw() +
  xlab("Role") + 
  ylab("Points") 

new_bb %>% slice_max(AST_per, n=50) %>% count(yr) %>% filter(yr == "Fr"|yr =="So"|yr =="Jr"|yr =="Sr") %>% ggplot(aes(x=yr,y = n,fill = yr)) + geom_col()+ theme_linedraw() + 
  xlab("College Year") + 
  ylab("Count")

```

```{r freshman plots}
#looking at freshman playing most games and scoring highest
top_25_fr_2019 %>%
  filter(GP > 20 & Min_per > 50) %>%
  ggplot(aes(x = twoP_per,y = TP_per)) + 
  geom_point() + 
  geom_text(aes(label = player),size = 4,ljust = .25)

top_fr_role_g %>%
  filter(Min_per > 59.9 & AST_per > 20 ) %>%
  ggplot(aes(x = twoP_per,y = TP_per)) + 
  geom_point() + 
  geom_text(aes(label = player),size = 4,ljust = .25)

```

```
3. Correlation between position and points scored(barplot) group-by(team), facet year
4. Correlation between rebounds(offense and def) position, and points scored (continuous)
```{r}
top_25s %>%
filter(year == 2020) %>%
  ggplot(aes(x = team,y = FTA)) +
  geom_bar()
```

5. Look at averages for all players and see which freshman stick out
6. filter players not appearing in latter years
7. Look at who improves throughout the years
filter for players who only play to junior year

