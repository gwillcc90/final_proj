---
title: "college_basketball"
author: "Will Curkan"
date: "11/14/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggplot2)
library(readxl)
```

```{r import data}
bb_dat = read.csv("CollegeBasketballPlayers2009-2021.csv")
school_dat = read_excel("bb_school_ranks.xlsx")
```

Cleaned data to make easier to work with:
1. rename variables to readable, workable names
2. filter to recent 3 years
3. remove less-meaningful variables
```{r data cleanup}
new_bb = bb_dat %>%
  rename(role = X, player = player_name) %>%
  filter(year > 2016) %>%
  select(!ht & !dunksmade & !dunksmiss.dunksmade
         & !dunksmade..dunksmade.dunksmiss.
         & !type & !num & !pid & !pick & !pfr
         & !Rec.Rank & !conf)

glimpse(new_bb)

#rename school to team to match new_bb
new_ranks = school_dat %>%
  rename(team = school)

glimpse(new_ranks)

# reminder to remove na data
# new_bb %>%
#   filter(is.na())
```

Creating joined frame to work with top 25 ranked schools:
```{r joined}
top_25s = right_join(new_bb,new_ranks)
```

In order to create a dream team for the 2022 season we must look at freshman in 2017(-2018), freshman and sophmores in 2018(-2019), and freshman, sophmore, and juniors in 2019(-2020)
```{r dream team filter}
#filters for freshman in 2017-2018 season
top_25_fr_2017 = top_25s %>%
  filter(yr == 'Fr' & year == 2017)

top_25_fr_2017

#filters for freshman and sophmores in 2018-2019 season
top_25_to_so_2018 = top_25s %>%
  filter(yr == "Fr" & year == 2018
         | yr == "So" & year == 2018)

top_25_to_so_2018

#need to filter for fr,so,and juniors in 2019-2020

#sampling years, need years 2019,2020,2021
new_bb %>%
  group_by(year) %>%
  summarize(n=n())
```

```{r}

top_25s %>% #number of players from each school
  group_by(team) %>%
  summarize(n=n(),
            n_players = n_distinct(player))

#looking at top offensive ratings
top_25s %>%
  arrange(desc(Ortg)) %>%
  filter(yr == "Fr", year == 2017)

# Duke U twoPOintAttem v percentage
new_bb %>%
  rename(pos = X) %>%
  select(team, pos) %>%
  filter(team == "Duke" & !pos == '') %>%
  group_by(pos) %>%
  summarize(n=n())
  ggplot(aes(x = twoPA,y=twoP_per)) + geom_point() +
  facet_wrap(~year)
  
```

1. Correlation between year (freshman, sophmore, etc) and stats
```{r}
top_25_fr_2017 %>%
  filter(GP > 20 & Min_per > 50) %>%
  ggplot(aes(x = twoPA, y = twoP_per)) + 
  geom_point()

top_25_fr_2017 %>%
  filter(GP > 20 & Min_per > 50) %>%
  ggplot(aes(x = ORB_per, y = TS_per)) + 
  geom_point()

```
2. correlation between year played(AD ex: 2014) and points scored
```{r}
#graph of pts attempted vs percentage made
top_25_fr_2017 %>%
  filter(GP > 20 & Min_per > 50) %>%
  ggplot(aes(x = twoPA, y = twoP_per)) + 
  geom_point()

top_25_fr_2017 %>%
  filter(GP > 20 & Min_per > 50) %>%
  arrange(desc(twoP_per))
```

```{r freshman ballers dat}
top_25_fr_2017 %>%
  filter(GP > 20 & Min_per > 50) %>%
  filter(Min_per > 59.9 & AST_per > 20 ) %>%
  arrange(desc(AST_per)) %>%
  group_by(role) %>%
  summarize(n=n())

top_25_fr_2017 %>%
  filter(GP > 20 & Min_per > 50) %>%
  arrange(desc(AST_per)) %>%
  group_by(role) %>%
  summarize(n=n())

#same code as above without the summary
#working w/top 5 scoring/point guards
top_25_fr_2017 %>%
filter(GP > 20 & Min_per > 50) %>%
filter(role == "Combo G" | role == "Scoring PG") %>%
filter(Min_per > 59.9) %>%
arrange(desc(AST_per))

#working with top 5 
top_25_fr_2017 %>%
filter(GP > 20 & Min_per > 50) %>%
filter(role == "Combo G" | role == "Scoring PG") %>%
filter(Min_per > 59.9) %>%
arrange(desc(AST_per))
```

```{r freshman ballers plot}
top_25_fr_2017 %>%
  filter(GP > 20 & Min_per > 50) %>%
  ggplot(aes(x = twoP_per,y = TP_per)) + 
  geom_point() + 
  geom_text(aes(label = player),size = 4,ljust = .25)

top_25_fr_2017 %>%
  filter(GP > 20 & Min_per > 50) %>%
  filter(role == "Combo G" | role == "Scoring PG") %>%
  filter(Min_per > 59.9 & AST_per > 20 ) %>%
  ggplot(aes(x = twoP_per,y = TP_per)) + 
  geom_point() + 
  geom_text(aes(label = player),size = 4,ljust = .25)
```

```{r fresh_soph baller stats}
#pg/sg
top_25_to_so_2018 %>%
  filter(GP > 20 & Min_per > 50) %>%
  filter(role == "Combo G" | role == "Scoring PG") %>%
  filter(Min_per > 59.9 & AST_per > 20 )

#Powerforward / center
top_25_to_so_2018 %>%
  filter(GP > 20 & Min_per > 50) %>%
  filter(role == "C" | role == "PF/C") %>%
  filter(Min_per > 59.9)




```
3. Correlation between position and points scored(barplot) group-by(team), facet year
```{r}
bb_dat %>%
  rename(pos = X) %>%
  filter(team == "Duke" | team == "Abilene Christian") %>%
  group_by(pos) %>%
  summarize(pts_scd = sum(FTM,2*twoPM,3*TPM, na.rm = True))

```
4. Correlation between rebounds(offense and def) position, and points scored (continuous)
5.
6. Create a dream team?
