---
title: "college_basketball"
author: "Will Curkan"
date: "11/14/2021"
output: html_document
---
WHAT IT TAKES

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(corrplot)
library(RColorBrewer)
library(stringr)
library(readxl)
```

We took the data from a kaggle dataset.
The data is the past decade's NCAA college basketball data filtered down to the last 3 seasons 18-19,19-20,20-21 for simplicity.
Our goal was to look at data trends based on role and academic status (being freshman, sophmores, juniors, and seniors)



```{r import data}
bb_dat = read.csv("CollegeBasketballPlayers2009-2021.csv")
school_dat = read_excel("bb_school_ranks.xlsx")

```

Cleaned data to make easier to work with:
1. rename variables to readable, workable names
2. filter to recent 3 years
3. remove less-meaningful variables
```{r data cleanup}
#create this vector to see assists for all top teams

new_bb = bb_dat %>%
  rename(role = X, player = player_name) %>%
  filter(year > 2018) %>%
  select(!ht & !dunksmade & !dunksmiss.dunksmade
         & !dunksmade..dunksmade.dunksmiss.
         & !type & !num & !pid & !pick & !pfr
         & !Rec.Rank) %>%
  mutate(top_team = ifelse(team %in% top_teams_vector,T,F))
  


#rename school to team to match new_bb
new_ranks = school_dat %>%
  rename(team = school) %>%
  add_count(team)%>%
  rename(appearances = n)

```



Creating joined frame to work with top 25 ranked schools:
```{r joined} 
#creating vector for top team in whole dataset
top_teams_vector = new_ranks$team

#recreating new_bb filter to show if player in top team
new_bb = new_bb %>%
  mutate(top_team = ifelse(team %in% top_teams_vector,T,F))

#46 teams have been in top 25 from (2018-)2019-2021
top_25s = inner_join(new_bb,new_ranks) %>%
  relocate(college_year = yr, year, role, .before = GP)


```
1. How many teams in the NCAA

```{r NCAA intro facts}
#unique teams in NCAA n = 358, all divisions
new_bb %>%
  distinct(team) %>%
  count()

#unique players in NCAA, 8697 in 2018+
new_bb %>%
  distinct(player) %>%
  count()

#88 players appearing in all 3 seasons up to 21-22, top 25
top_25s %>%
  filter(!college_year == "Sr") %>%
  add_count(player) %>%
  filter(n == 3) %>%
  group_by(player) %>%
  summarize(n = n()) %>%
  count()
```

1.Free Throws are incredibly important because they are uncontested shots 
```{r free throws}
new_bb %>%
  # filter(FTA > 58 & FT_per > .769) %>%
  ggplot(aes(x = FTA,y = FT_per)) +
  geom_point() + 
  geom_smooth()+
  xlab("Free Throw Attempts") +
  ylab("Free Throw Percentage")+
  ggtitle("General Free Throw Comparison")

#guards
new_bb %>%
  filter(FTA > 58 & FT_per > .769) %>%
      filter(role == "Combo G" | role == "Scoring PG"
        | role == "Wing G" | role == "Pure PG") %>%
  ggplot(aes(x = FTA,y = FT_per)) +
  geom_point() + 
  geom_smooth()+
  xlab("Free Throw Attempts") +
  ylab("Free Throw Percentage")+
  ggtitle("Guard Free Throws")

#Centers/Powerforwards
new_bb %>%
  filter(FTA > 58 & FT_per > .769) %>%
  filter(role == "PF/C" | role == "C"
        | role == "Wing F" | role == "Stretch 4") %>%
  ggplot(aes(x = FTA,y = FT_per)) +
  geom_point() + 
  geom_smooth()+
  xlab("Free Throw Attempts") +
  ylab("Free Throw Percentage")+
  ggtitle("Post Player Free Throws")

quantile(new_bb$FT_per,c(.25,.5,.75))
quantile(new_bb$FTA,c(.25,.5,.75))
```

2. Rebounds are important because this is where the teams show who wnats it more, this is where the game get's physical, and personal.

```{r rebound comparison}
#maybe use density graph for this
new_bb %>%
  filter(GP > 29) %>%
  ggplot(aes(x = ORB_per,y = DRB_per)) +
  geom_point() + 
  geom_smooth()+ 
  xlab("Offensive Rebound Percentage")+
  ylab("Defensive Rebound Percentage")+
  ggtitle("Rebound Comparison")

#Guards
new_bb %>%
  filter(GP > 29 & ORB_per >= 7.6 & DRB_per >= 16.7) %>%
    filter(role == "Combo G" | role == "Scoring PG"
        | role == "Wing G" | role == "Pure PG") %>%
  filter(!yr == "Sr") %>%
  ggplot(aes(x = ORB_per,y = DRB_per, color = team)) +
  geom_point() + 
  geom_smooth()+ 
  xlab("Offensive Rebound Percentage")+
  ylab("Defensive Rebound Percentage")+
  ggtitle("Guard Rebound Comparison")

#Center/Powerforwards
new_bb %>%
  filter(GP > 29 & ORB_per >= 7.6 & DRB_per >= 16.7) %>%
  filter(role == "PF/C" | role == "C"
        | role == "Wing F" | role == "Stretch 4") %>%
  filter(!yr == "Sr") %>%
  ggplot(aes(x = ORB_per,y = DRB_per)) +
  geom_point() + 
  geom_smooth()+
  facet_wrap(~yr)+
  xlab("Offensive Rebound Percentage")+
  ylab("Defensive Rebound Percentage")+
  labs(title = "Post Player Rebound Comparison",
       subtitle = "")

quantile(new_bb$GP,c(.25,.5,.75))
quantile(new_bb$ORB_per,c(.25,.5,.75))
quantile(new_bb$DRB_per,c(.25,.5,.75))
```



```{r top 10 asts}
options(scipen = 999)
top_25s %>%
  na.omit() %>%
  filter(appearances == 3) %>%
  group_by(team) %>%
  summarize(n = sum(ast))%>%
  arrange(desc(n)) %>%
  ggplot()+
  geom_col(aes(x = team,y = n,fill = team))+
  ggtitle("Total Assist for Team with 3 appearances")+
  xlab("Team")+
  ylab("Assists")+
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank())
  

some_new_bb = new_bb %>%
  filter(top_team == T) %>%
  left_join(new_ranks)

some_new_bb %>%
  group_by(team) %>%
  summarize(n_ast = mean(ast)) %>%
  left_join(some_new_bb) %>%
  na.omit() %>%
  ggplot() +
  geom_density(aes(x = n_ast, color = as.factor(appearances)))+
  ggtitle(label = "Mean Assists of All Teams \nAppearing in the top 25",
        subtitle = "independent of season rank \nfor all seasons")+
  labs(color = "Appearances in Top 25")

```

```{r ast/tov}
top_25s %>%
  na.omit() %>%
  filter(ast.tov > 1 & GP > 29) %>%
  ggplot(aes(x = GP,y = ast.tov))+
  geom_point()+
  geom_smooth()
  
```

In order to create a dream team for the 2022 season we must look at freshman in 2018-2019, freshman and sophmores in 2019-2020, and freshman, sophmore, and juniors in 2020-2021
```{r freshman 2019 filters}
#top freshman guards
top_fr_guards = top_25s %>%
  filter(college_year == 'Fr' & year == 2019 & GP > 25) %>%
  filter(role == "Combo G" | role == "Scoring PG"
        | role == "Wing G" | role == "Pure PG")


#top powerforwards and centers
top_fr_PfC = top_25s %>%
  filter(college_year == 'Fr' & year == 2019) %>%
  filter(role == "PF/C" | role == "C"
        | role == "Wing F" | role == "Stretch 4")

# corrplot(cor(cont_dat),type="upper", order="hclust",col=brewer.pal(n=8, name="RdYlBu"))
``` 

```{r freshman plots}
top_fr_guards %>% 
  select(where(is.double))
  
top_fr_guards %>%
  ggplot(aes(x = twoPA)) +
  geom_histogram()

top_fr_PfC %>%
  ggplot(aes(x = twoPA,y = twoPM)) +
  geom_violin()

top_fr_PfC %>%
  arrange(desc(DRB_per,twoP_per)) %>%
  slice(1:5) %>%
  ggplot(aes(x = DRB_per,y = twoP_per)) +
  geom_point() +
  geom_smooth() + 
  geom_text(aes(label=player))

top_fr_PfC %>%
  arrange(desc(DRB_per,twoP_per)) %>%
  slice(1:5) %>%
  ggplot(aes(x = DRB_per,y = twoP_per)) +
  geom_point() +
  geom_smooth() + 
  geom_text(aes(label=player))


#filter for top DRB percentage and shooting
top_fr_PfC %>%
  arrange(desc(DRB_per,twoP_per)) %>%
  filter(Min_per > 50)
  

```

```{r fresh_soph_2020 filters}
#filters for freshman and sophmores in 2018-2019 season
top_25_2soph_2020 = top_25s %>%
  filter(college_year == "Fr" & year == 2020
         |college_year == "So" & year == 2020)

#top guards
top_2soph_role_g_2020 = top_25_2soph_2020 %>%
    filter(role == "Combo G" | role == "Scoring PG"
         | role == "Wing G" | role == "Pure PG")

#top powerforwards/center
top_2soph_role_pfC_2020 = top_25_2soph_2020 %>%
      filter(role == "PF/C" | role == "C"
         | role == "Wing F" | role == "Stretch 4")
```


```{r to juniors 2021}
#freshman, sophmore, juniors in 2020-2021 season

#top guards
top_2jnr_guards = top_25s %>%
  filter(!yr == "Sr") %>%
  filter(role == "Combo G" | role == "Scoring PG"
         | role == "Wing G" | role == "Pure PG")

#top powerforwards/center
top_2jnr_PfC = top_25s %>%
  filter(!yr == "Sr") %>%
  filter(role == "PF/C" | role == "C"
         | role == "Wing F" | role == "Stretch 4")


```




1. Correlation between year (freshman, sophmore, etc) and stats
or recurring players and juniors
```{r}
#looking at individual recurring players stats
recurring_andJuniors = top_25s %>%
  add_count(player) %>%
  filter(college_year == "Jr" | n == 3 & GP > 20)

#use scatterplot to compare individual recurring stats maybe
recurring_players %>%
  filter(GP > 20) %>%
  ggplot(aes(x=player,y=pts)) + 
  geom_point(aes(x=player,y=pts,color=player)) + 
  theme_linedraw() +
  xlab("Role") + 
  ylab("Points") +
  scale_x_discrete(labels = paste0('p',c(1:9)))


```






```{r}
new_bb$role[new_bb$role == ""] <- NA
new_bb %>% na.omit() %>% ggplot(aes(x=role,y=pts,fill=role)) +
  geom_boxplot(aes(na.rm=T)) + theme_linedraw() + 
  xlab("Role") + ylab("Points")

new_bb  %>% na.omit() %>% ggplot(aes(x=role,y=pts,fill=role)) + 
  geom_boxplot(aes(x=role,y=pts,fill=role,na.rm=T)) + 
  geom_text_repel(data = subset(bb_dat, pts >= 26), aes(label = player_name))+theme_linedraw() +
  xlab("Role") + 
  ylab("Points") 

new_bb %>% slice_max(AST_per, n=50) %>% count(yr) %>% filter(yr == "Fr"|yr =="So"|yr =="Jr"|yr =="Sr") %>% ggplot(aes(x=yr,y = n,fill = yr)) + geom_col()+ theme_linedraw() + 
  xlab("College Year") + 
  ylab("Count")

```

```{r freshman plots}
#looking at freshman playing most games and scoring highest
top_25_fr_2019 %>%
  filter(GP > 20 & Min_per > 50) %>%
  ggplot(aes(x = twoP_per,y = TP_per)) + 
  geom_point() + 
  geom_text(aes(label = player),size = 4,ljust = .25)

top_fr_role_g %>%
  filter(Min_per > 59.9 & AST_per > 20 ) %>%
  ggplot(aes(x = twoP_per,y = TP_per)) + 
  geom_point() + 
  geom_text(aes(label = player),size = 4,ljust = .25)

```

```
3. Correlation between position and points scored(barplot) group-by(team), facet year
4. Correlation between rebounds(offense and def) position, and points scored (continuous)
```{r}
top_25s %>%
filter(year == 2020) %>%
  ggplot(aes(x = team,y = FTA)) +
  geom_bar()
```

5. Look at averages for all players and see which freshman stick out
6. filter players not appearing in latter years

